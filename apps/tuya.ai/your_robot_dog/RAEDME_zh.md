[English](./README.md) | 简体中文

# your_robot_dog
 [your_robot_dog](./img/robot_dog.png)(https://github.com/tuya/TuyaOpen/tree/master/apps/tuya.ai/your_robot_dog) 是基于 TuyaOS 的 tuyaos_demo_ai_toy 项目在 TuyaOpen 的 your_char_bot 基础上移植而来，添加机器狗生动表情变化与控制舵机动作，移植开源的大模型智能聊天机器狗。通过麦克风采集语音，语音识别，实现对话、互动、调侃，还能通过屏幕看到情感变化，以及互动行为。

## 支持功能
1. AI 智能对话
2. 按键唤醒/语音唤醒, 回合制对话，支持语音打断（需硬件支持）
3. 表情显示
4. 支持 LCD 显示实时聊天内容、支持 APP 端实时查看聊天内容
5. APP 端实时切换 AI 智能体角色
6. 语音控制机器狗行为

## 依赖硬件能力
1. 音频采集
2. 音频播放
2. 舵机驱动

## 已支持硬件
|  型号  | config | 
| --- | --- | 
| TUYA_T5AI_ROBOT_DOG | TUYA_T5AI_ROBOT_DOG.config | 

## 硬件烧录方式
自备CH340，连接方式：
CH340            TUYA_T5AI_ROBOT_DOG                                   
TX  -------------- RX0                                                   
RX  -------------- TX0                                                   
RST -------------- RST                                                   
查看串口日志方式：
CH340            TUYA_T5AI_ROBOT_DOG                                   
TX  -------------- RX_L                                                   
RX  -------------- TX_L                                                  
GND -------------- GND   
必须共地不然日志可能乱码。

## 编译
1. 运行 `tos.py config choice` 命令， 选择TUYA_T5AI_ROBOT_DOG.config。
2. 如需修改配置，请先运行 `tos.py config menu` 命令修改配置。
3. 运行 `tos.py build` 命令，编译工程。

## 配置说明

### 默认配置
- 随意对话模式，未开启 AEC，不支持打断
- 唤醒词：
  - T5AI 版本： 你好涂鸦

### 通用配置

- **选择对话模式**

  - 长按对话模式

    | 宏                                     | 类型 | 说明                                   |
    | -------------------------------------- | ---- | -------------------------------------- |
    | ENABLE_CHAT_MODE_KEY_PRESS_HOLD_SINGEL | 布尔 | 按住按键后说话，一句话说完后松开按键。 |

  - 按键对话模式

    | 宏                                 | 类型 | 说明                                                         |
    | ---------------------------------- | ---- | ------------------------------------------------------------ |
    | ENABLE_CHAT_MODE_KEY_TRIG_VAD_FREE | 布尔 | 按一下按键，设备会进入/退出聆听状态。如果在聆听状态，会开启 vad 检测，此时可以进行对话。 |

  - 唤醒对话模式

    | 宏                                 | 类型 | 说明                                                         |
    | ---------------------------------- | ---- | ------------------------------------------------------------ |
    | ENABLE_CHAT_MODE_ASR_WAKEUP_SINGEL | 布尔 | 需要说出唤醒词才能唤醒设备，设备唤醒后会进入聆听状态，此时可以进行对话。每次唤醒只能进行一轮对话。如果想继续对话，需要再次用唤醒词唤醒。 |

  - 随意对话模式

    | 宏                               | 类型 | 说明                                                         |
    | -------------------------------- | ---- | ------------------------------------------------------------ |
    | ENABLE_CHAT_MODE_ASR_WAKEUP_FREE | 布尔 | 需要说出唤醒词才能唤醒设备，设备唤醒后会进入聆听状态，此时可以进行随意对话。如果 30S 没有检测到声音，则需要再次唤醒。 |

- **唤醒词**
  该配置只会在对话模式选择**唤醒对话**和**随意对话**两种模式下才会出现。
  | 宏                                    | 类型 | 说明                |
  | ------------------------------------- | ---- | ------------------- |
  | ENABLE_WAKEUP_KEYWORD_NIHAO_TUYA      | 布尔 | 唤醒词是 “你好涂鸦” |

- **是否支持 AEC**

  | 宏         | 类型 | 说明                                                         |
  | ---------- | ---- | ------------------------------------------------------------ |
  | ENABLE_AEC | 布尔 | 这个是根据板子的硬件是否有回声消除功能来配置。<br />如果板子支持回声消除，则把该配置打开。**如果板子不支持回声消除，则需要关闭该功能，否则会影响唤醒对话功能**。<br />该配置没打开，则不支持语音打断的功能。 |

- **喇叭使能引脚**

  | 宏             | 类型 | 说明                                 |
  | -------------- | ---- | ------------------------------------ |
  | SPEAKER_EN_PIN | 数值 | 该引脚控制喇叭是否使能，范围：0-64。 |

- **对话按键引脚**

  | 宏              | 类型 | 说明                             |
  | --------------- | ---- | -------------------------------- |
  | CHAT_BUTTON_PIN | 数值 | 控制对话的按键引脚，范围：0-64。 |

- **使能显示**

  | 选项                        | 说明                                             |
  | -------------------------   | ------------------------------------------------ |
  | enable the display module   | 使能显示功能，如果板子有带屏幕，可将该功能打开。 |
  | enable the dog action       | 使能小狗动作。 |

### 显示配置

显示使能被打开后，以下配置才会出现。

- **选择显示 UI 风格**

  | 选项                 | 类型 | 说明                     |
  | ------------------   | ---- | ------------------------ |
  | Use Robot Dog ui     | 布尔 | 默认配置，显示上方状态栏与小狗表情 |

### 文件系统配置
  必要配置：机器狗部分表情gif已打包为LittleFS镜像位于./src/display/emotion/fs/fs.bin，必须将其烧入FLASH中指定地址处。
  若不配置可能导致系统访问非法地址（表现为一直重启）或小狗表情显示不全。
  步骤如下：
  下载烧录工具 BKFIL，BKFIL 是 Beken FLASH Image Loader 的简称，是 Armino 官方烧录与配置工具。
  进入后在"选择串口"中选中烧录串口，在"Bin文件路径"中选中fs.bin的路径。(./img/BKFIL_1.png)
  选中"配置"页面，在fs.bin那一栏配置起始地址为0x6cb000，文件长度为0x100000。(./img/BKFIL_2.png)
  进入主界面点击烧录即可。

## 补充说明
  your_robot_dog为移植项目，TUYA_T5AI_ROBOT_DOG的底板与常规T5AI开发板对比有较大差异。
  暂未支持音乐播放与摄像头功能。

